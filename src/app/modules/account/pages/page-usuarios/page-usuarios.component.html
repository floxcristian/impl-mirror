<div class="  ">
  <div class="top-bar-categories d-flex align-items-center">
    <div class="title d-flex align-items-center me-auto">
      <i _ngcontent-serverapp-c11="" class="fas fa-users me-3"></i>
      <h5>Usuarios</h5>
    </div>
  </div>

  <div class="card-body position-relative">
    <app-loading-element *ngIf="loadingData"></app-loading-element>

    <div class="row">
      <div class="col"></div>
      <div class="col">
        <div class="float-end">
          <button
            name="openUserForm"
            class="btn btn-success"
            (click)="openUserForm(template_usuario, false)"
          >
            Crear Usuario
          </button>
        </div>
      </div>
    </div>

    <div class="table-responsive-sm" style="margin-top: 20px">
      <table datatable [dtOptions]="dtOptions" class="row-border hover">
        <tbody *ngIf="users.length != 0">
          <tr *ngFor="let user of users">
            <td>{{ user.username }}</td>
            <td>{{ user.company }}</td>
            <td>{{ user.rut }}</td>
            <td>{{ user.first_name }}</td>
            <td>{{ user.last_name }}</td>
            <td>{{ user.user_role }}</td>
            <td align="center">
              <div class="form-check form-switch">
                <input
                  type="checkbox"
                  class="form-check-input"
                  id="s{{ user._id }}"
                  [disabled]="true"
                  [checked]="user.active"
                />
                <label class="form-check-label" for="s{{ user._id }}"></label>
              </div>
            </td>
            <td align="center">
              <button
                name="Editar"
                class="btn btn-secondary"
                (click)="selectUser(user); openUserForm(template_usuario, true)"
              >
                Editar</button
              >&nbsp;
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<ng-template #template_usuario>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Usuario</h4>
    <button
      name="modalRef"
      type="button"
      class="btn-close pull-right"
      aria-label="Close"
      (click)="closeModal()"
    >
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form [formGroup]="formUsuario" (ngSubmit)="onSubmit(formUsuario.value)">
      <div class="form-group">
        <input
          type="hidden"
          class="form-control"
          id="_id"
          formControlName="_id"
        />
      </div>
      <div class="form-group form-check form-switch">
        <input
          type="checkbox"
          class="form-check-input"
          formControlName="active"
          id="active"
        />
        <label class="form-check-label" for="active">Activo</label>
      </div>
      <div class="form-group">
        <label for="username">Usuario:</label>
        <input
          type="text"
          class="form-control"
          id="username"
          formControlName="username"
          placeholder="Ingrese Nombre de Usuario"
        />
      </div>
      <p
        *ngIf="
          formUsuario.controls['username'].invalid &&
          formUsuario.controls['username'].touched
        "
        class="text-error-form-2"
      >
        Debe Ingresar Nombre de Usuario
      </p>
      <div class="form-group">
        <label for="email">Email:</label>
        <input
          type="email"
          class="form-control"
          id="email"
          formControlName="email"
          placeholder="Ingrese Email"
        />
      </div>
      <p
        *ngIf="
          formUsuario.controls['email'].invalid &&
          formUsuario.controls['email'].touched
        "
        class="text-error-form-2"
      >
        Debe Ingresar Nombre de Usuario
      </p>
      <div class="form-group">
        <label for="password">Password:</label>
        <input
          type="password"
          class="form-control"
          id="password"
          formControlName="password"
          placeholder="Ingrese Contraseña"
        />
      </div>

      <div class="form-group">
        <label for="first_name">Nombres:</label>
        <input
          type="text"
          class="form-control"
          id="first_name"
          formControlName="first_name"
          placeholder="Ingrese Nombres"
        />
      </div>

      <div class="form-group">
        <label for="last_name">Apellidos:</label>
        <input
          type="text"
          class="form-control"
          id="last_name"
          formControlName="last_name"
          placeholder="Ingrese Apellidos"
        />
      </div>

      <div class="form-group">
        <label for="company">Empresa</label>
        <input
          type="text"
          name="company"
          class="form-control"
          id="company"
          formControlName="company"
          placeholder="Ingrese Empresa"
        />
      </div>

      <div class="form-group">
        <label for="rut">RUT Empresa:</label>
        <input
          formatRut
          appRutChars
          name="rut"
          class="form-control"
          id="rut"
          formControlName="rut"
          placeholder="Ingrese Rute de Empresa"
        />
        <p
          *ngIf="
            formUsuario.controls['rut'].errors?.['invalidRut'] &&
            formUsuario.controls['rut'].touched
          "
          class="text-error-form-2 pull-right"
        >
          El RUT ingresado no es válido
        </p>
      </div>

      <div class="form-group">
        <label for="method_payment">Medio de Pago</label>
        <input
          type="text"
          name="method_payment"
          class="form-control"
          id="method_payment"
          formControlName="method_payment"
          placeholder="Ingrese Medio de Pago"
        />
      </div>
      <div class="form-group">
        <label for="user_role">ROL</label>
        <!-- <input type="text" name="user_role" class="form-control" id="user_role" formControlName="user_role" placeholder="Ingrese ROL"> -->
        <select
          name="user_role"
          class="form-control"
          id="user_role"
          formControlName="user_role"
        >
          <option value="" selected disabled>
            -- Seleccione ROL de Usuario --
          </option>
          <option value="cms">CMS</option>
          <option value="compradorb2c">B2C</option>
          <option value="supervisor">Supervisor</option>
          <option value="comprador">Comprador</option>
          <option value="superadmin">Usuario Implementos</option>
        </select>
      </div>

      <button
        name="salir"
        type="button"
        class="btn btn-secondary"
        aria-label="Close"
        (click)="modalRef.hide(); formUser()"
      >
        Salir
      </button>
      &nbsp;&nbsp;

      <button
        name="Crear"
        type="submit"
        class="btn btn-success"
        *ngIf="this.editUser == false"
        [disabled]="!formUsuario.valid"
      >
        Crear Usuario
      </button>
      <button
        name="Actualizar"
        type="submit"
        class="btn btn-success"
        *ngIf="this.editUser == true"
        [disabled]="!formUsuario.valid"
      >
        Actualizar Usuario
      </button>
    </form>
  </div>
</ng-template>
